{% load static %}
{% load avaliacao_tags %}
{% load repeat %}

<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avalia√ß√£o de {{ colaborador.nome }}</title>
    
    <link rel="icon" type="image/x-icon" href="{% static 'assets/favicon.ico'%}" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        :root {
            --primary-color: #3498DB;
            --primary-rgb: 52, 152, 219;
            --primary-dark: #2980b9;
            --background-color: #f8fafc;
            --card-background: #ffffff;
            --border-color: #e5e7eb;
            --text-color: #334155;
            --text-muted: #64748b;
            --star-color: #fbbf24;
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            padding-top: 100px; 
            padding-bottom: 120px; 
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        /* --- Cabe√ßalho Fixo --- */
        .page-header-fixed {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(8px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            padding: 1rem;
            z-index: 10;
        }
        .header-content {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .profile-header {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .profile-header .avatar-image {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary-color);
        }
        .profile-header h1 {
            font-size: 1.25rem;
            font-weight: 600;
            margin: 0;
            color: #111827;
        }
        .profile-header p {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin: 0;
        }
        .btn-back {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
        }
        .btn-back:hover {
            background-color: #f1f5f9;
        }

        /* --- Se√ß√µes do Formul√°rio --- */
        .form-section {
            background-color: var(--card-background);
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.05);
            border: 1px solid var(--border-color);
            margin-top: 1.5rem;
            overflow: hidden;
        }
        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #111827;
            padding: 1.5rem 2rem;
            margin: 0;
            background-color: #f9fafb;
            border-bottom: 1px solid var(--border-color);
        }
        .section-title .emoji {
            margin-right: 0.5rem;
            font-size: 1.5rem;
        }
        
        /* Lista de Avalia√ß√£o */
        .rating-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .rating-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.25rem 2rem;
            border-bottom: 1px solid var(--border-color);
            transition: background-color 0.2s ease;
        }
        .rating-item:hover {
            background-color: #fcfdff;
        }
        .rating-item:last-child {
            border-bottom: none;
        }
        .rating-info .rating-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-color);
            margin: 0;
        }
        .rating-info .help-text {
            font-size: 0.875rem;
            color: var(--text-muted);
            margin: 0;
        }
        .rating-stars {
            flex-shrink: 0;
        }

        /* Estrelas */
        .stars {
            display: flex;
            flex-direction: row-reverse;
            gap: 0.25rem;
            justify-content: center;
        }
        .star-rating { display: none; }
        .star-label {
            cursor: pointer;
            font-size: 2.25rem;
            color: #e5e7eb;
            transition: all 0.2s;
            padding: 0 0.1rem;
        }
        .star-label:hover,
        .star-label:hover ~ .star-label,
        .star-rating:checked ~ .star-label {
            color: var(--star-color);
            transform: scale(1.1);
        }
        
        /* Inputs de Texto e Textarea */
        .input-box {
            padding: 1.5rem 2rem;
            position: relative; /* Para as sugest√µes */
        }
        .form-label-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 0.5rem;
            display: block;
        }
        input[type="text"], textarea {
            width: 100%; 
            padding: 0.75rem 1rem; 
            border: 1px solid var(--border-color); 
            border-radius: 0.5rem; 
            font-family: inherit;
            font-size: 1rem;
        }
        input[type="text"]:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(var(--primary-rgb), 0.2);
        }
        textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* Sugest√µes de Restaurante */
        .suggestions {
            position: absolute;
            width: calc(100% - 4rem); /* Desconta o padding do .input-box */
            max-height: 150px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 0 0 0.5rem 0.5rem;
            background-color: white;
            z-index: 999;
            margin-top: -1px; /* Gruda no input */
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        .suggestion-item { padding: 0.75rem 1rem; cursor: pointer; }
        .suggestion-item:hover { background-color: #f1f5f9; }

        /* Bot√£o de Envio Fixo */
        .submit-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: rgba(255, 255, 255, 0.95);
            padding: 1.5rem;
            box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.05);
            backdrop-filter: blur(8px);
            z-index: 10;
        }
        .submit-button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 1.25rem 2rem;
            border-radius: 0.75rem;
            font-size: 1.125rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            max-width: 900px;
            display: block;
            margin: 0 auto;
        }
        .submit-button:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(var(--primary-rgb), 0.2);
        }
        
        @media (max-width: 600px) {
            .rating-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            .rating-stars {
                width: 100%;
                justify-content: flex-end;
            }
            .profile-header h1 {
                font-size: 1rem;
            }
            .profile-header p {
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>

    <div class="page-header-fixed">
        <div class="header-content">
            <div class="profile-header">
                <img src="{{ colaborador.imagem.url }}" alt="Avatar" class="avatar-image">
                <div>
                    <h1>{{ colaborador.nome }}</h1>
                    <p>Avalia√ß√£o do Restaurante</p>
                </div>
            </div>
            <a href="{% url 'home' %}" class="btn-back">
                <i class="bi bi-x-lg"></i> Fechar
            </a>
        </div>
    </div>

    <div class="container">
        <form method="post" class="evaluation-form" id="evaluationForm">
            {% csrf_token %}
            
            <div class="form-section">
                <h2 class="section-title"><span class="emoji">üìù</span> Suas Informa√ß√µes</h2>
                <div class="input-box" style="border-bottom: 1px solid var(--border-color);">
                    <label class="form-label-title" for="loja">Nome do seu Restaurante <span style="color: var(--primary-color);_">*</span></label>
                    <input type="text" name="nome_restaurante" id="loja" placeholder="Digite o nome do seu restaurante" required>
                    <div id="suggestions-container" class="suggestions" style="display: none;"></div>
                </div>
                <div class="input-box">
                    <label class="form-label-title" for="nome_avaliador_restaurante">Seu Nome (Opcional)</label>
                    <input type="text" name="nome_avaliador_restaurante" id="nome_avaliador_restaurante" placeholder="Digite seu nome (opcional)">
                </div>
            </div>

            <div class="form-section">
                <h2 class="section-title"><span class="emoji">‚≠ê</span> Avalie o Atendimento</h2>
                <ul class="rating-list">
                    
                    <li class="rating-item">
                        <div class="rating-info">
                            <h3 class="rating-title">Rapidez no Atendimento</h3>
                            <p class="help-text">O colaborador foi √°gil ao te atender?</p>
                        </div>
                        <div class="stars rating-stars">
                            {% for i in '54321'|make_list %}<input type="radio" name="rapidez_atendimento" value="{{ i }}" id="rapidez_atendimento_{{ i }}" class="star-rating" required><label class="star-label" for="rapidez_atendimento_{{ i }}">‚òÖ</label>{% endfor %}
                        </div>
                    </li>

                    <li class="rating-item">
                        <div class="rating-info">
                            <h3 class="rating-title">Efici√™ncia na Resolu√ß√£o</h3>
                            <p class="help-text">Resolveu seus problemas rapidamente?</p>
                        </div>
                        <div class="stars rating-stars">
                            {% for i in '54321'|make_list %}<input type="radio" name="eficiencia_resolucao" value="{{ i }}" id="eficiencia_resolucao_{{ i }}" class="star-rating" required><label class="star-label" for="eficiencia_resolucao_{{ i }}">‚òÖ</label>{% endfor %}
                        </div>
                    </li>

                    <li class="rating-item">
                        <div class="rating-info">
                            <h3 class="rating-title">Clareza na Comunica√ß√£o</h3>
                            <p class="help-text">A comunica√ß√£o foi clara e f√°cil de entender?</p>
                        </div>
                        <div class="stars rating-stars">
                            {% for i in '54321'|make_list %}<input type="radio" name="clareza_comunicacao" value="{{ i }}" id="clareza_comunicacao_{{ i }}" class="star-rating" required><label class="star-label" for="clareza_comunicacao_{{ i }}">‚òÖ</label>{% endfor %}
                        </div>
                    </li>

                    <li class="rating-item">
                        <div class="rating-info">
                            <h3 class="rating-title">Profissionalismo</h3>
                            <p class="help-text">O colaborador foi educado e profissional?</p>
                        </div>
                        <div class="stars rating-stars">
                            {% for i in '54321'|make_list %}<input type="radio" name="profissionalismo" value="{{ i }}" id="profissionalismo_{{ i }}" class="star-rating" required><label class="star-label" for="profissionalismo_{{ i }}">‚òÖ</label>{% endfor %}
                        </div>
                    </li>

                    <li class="rating-item">
                        <div class="rating-info">
                            <h3 class="rating-title">Suporte na Gest√£o de Pedidos</h3>
                            <p class="help-text">Ajudou de forma eficiente na gest√£o dos pedidos?</p>
                        </div>
                        <div class="stars rating-stars">
                            {% for i in '54321'|make_list %}<input type="radio" name="suporte_gestao_pedidos" value="{{ i }}" id="suporte_gestao_pedidos_{{ i }}" class="star-rating" required><label class="star-label" for="suporte_gestao_pedidos_{{ i }}">‚òÖ</label>{% endfor %}
                        </div>
                    </li>

                    <li class="rating-item">
                        <div class="rating-info">
                            <h3 class="rating-title">Proatividade</h3>
                            <p class="help-text">O colaborador se antecipou aos problemas?</p>
                        </div>
                        <div class="stars rating-stars">
                            {% for i in '54321'|make_list %}<input type="radio" name="proatividade" value="{{ i }}" id="proatividade_{{ i }}" class="star-rating" required><label class="star-label" for="proatividade_{{ i }}">‚òÖ</label>{% endfor %}
                        </div>
                    </li>

                    <li class="rating-item">
                        <div class="rating-info">
                            <h3 class="rating-title">Disponibilidade</h3>
                            <p class="help-text">Foi f√°cil encontrar e falar com o colaborador?</p>
                        </div>
                        <div class="stars rating-stars">
                            {% for i in '54321'|make_list %}<input type="radio" name="disponibilidade" value="{{ i }}" id="disponibilidade_{{ i }}" class="star-rating" required><label class="star-label" for="disponibilidade_{{ i }}">‚òÖ</label>{% endfor %}
                        </div>
                    </li>

                    <li class="rating-item">
                        <div class="rating-info">
                            <h3 class="rating-title">Satisfa√ß√£o Geral</h3>
                            <p class="help-text">Qual sua nota geral para este colaborador?</p>
                        </div>
                        <div class="stars rating-stars">
                            {% for i in '54321'|make_list %}<input type="radio" name="satisfacao_geral" value="{{ i }}" id="satisfacao_geral_{{ i }}" class="star-rating" required><label class="star-label" for="satisfacao_geral_{{ i }}">‚òÖ</label>{% endfor %}
                        </div>
                    </li>
                </ul>
            </div>

            <div class="form-section">
                <h2 class="section-title"><span class="emoji">üí¨</span> Coment√°rio Adicional</h2>
                <div class="input-box">
                    <label class="form-label-title" for="comentario">Deixe um coment√°rio (Opcional)</label>
                    <textarea name="comentario" id="comentario" rows="4" placeholder="Compartilhe sua experi√™ncia e sugest√µes de melhoria..."></textarea>
                </div>
            </div>

            <div class="submit-footer">
                <button type="submit" class="submit-button">Enviar Avalia√ß√£o ‚ú®</button>
            </div>
        </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const restaurantes = [
                "Arabi's", "Bello Pastel", "Cacau Show", "Chikens do Mc",
                "Croasonho", "Di Gramado", "Gelobel",
                "Ice Creamy", "Kekala", "Mc Donald's", "Milanetto",
                "Mister Cuca", "Mr. Cheff", "Naturela", "Patroni Pizza",
                "Pop Corn Gourmet", "Popeyes Chiken", "Santo Strogonoff",
                "Spedini Trattoria", "The B Burger", "Trilha Verde", "Ponto Grill",
                "Subway", "10 Past√©is", "Johnny Smash Burger",
                "Toutsie", "The Waffle King", "Havanna", "Mr. Fritz",
                "Doce Mania", "Baldes do Popeyes", "Biscoit√™",
                "Mania de Churrasco", "Burger King", "Feijuca",
                "Hot and Roll", "Menu Poke", "Montana Burger",
                "Montana Grill", "Original Prime Grill",
                "Spoleto", "Oakberry A√ßai", "Pastel Mel", "Pra√ßa Food",
                "Kopenhagen", "Suc√£o",
                "Lugano", "La Pasta Gialla", "Villa Fontana",
                "A√ßa√≠ Official", "Bacio Di Latte", "Bello Strogonoff",
                "Bobs", "Buona Massa", "Fast Grill", "Frango no Pote", "KFC",
                "Koni", "Lindt", "My Poke", "Naturalle",
                "Panelinhas do Brasil", "Peixe na Rede",
                "Poke Land", "Vivenda do Camar√£o", "Sushiloko",
                "American Cookies", "Dom Casero", "La Guapa",
                "Madero", "Marvin Burger", "Marietta", "Munch",
                "Nespresso", "P√°prica Burger", "Pobre Juan"
            ];

            const lojaInput = document.getElementById('loja');
            const suggestionsContainer = document.getElementById('suggestions-container');

            lojaInput.addEventListener('input', function() {
                const inputValue = this.value.toLowerCase();
                
                if (inputValue === '') {
                    suggestionsContainer.style.display = 'none';
                    return;
                }

                const restaurantesFiltrados = restaurantes.filter(restaurante => 
                    restaurante.toLowerCase().includes(inputValue)
                );

                suggestionsContainer.innerHTML = '';

                if (restaurantesFiltrados.length > 0) {
                    suggestionsContainer.style.display = 'block';
                    restaurantesFiltrados.forEach(restaurante => {
                        const suggestionItem = document.createElement('div');
                        suggestionItem.classList.add('suggestion-item');
                        suggestionItem.textContent = restaurante;
                        suggestionItem.addEventListener('click', function() {
                            lojaInput.value = restaurante;
                            suggestionsContainer.style.display = 'none';
                        });
                        suggestionsContainer.appendChild(suggestionItem);
                    });
                } else {
                    suggestionsContainer.style.display = 'none';
                }
            });

            // Esconder sugest√µes ao clicar fora
            document.addEventListener('click', function(event) {
                if (!lojaInput.contains(event.target) && !suggestionsContainer.contains(event.target)) {
                    suggestionsContainer.style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>